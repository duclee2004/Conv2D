// ==============================================================
// RTL generated by Vivado(TM) HLS - High-Level Synthesis from C, C++ and SystemC
// Version: 2018.3
// Copyright (C) 1986-2018 Xilinx, Inc. All Rights Reserved.
// 
// ===========================================================

`timescale 1 ns / 1 ps 

(* CORE_GENERATION_INFO="conv2d,hls_ip_2018_3,{HLS_INPUT_TYPE=cxx,HLS_INPUT_FLOAT=0,HLS_INPUT_FIXED=0,HLS_INPUT_PART=xc7z020clg484-1,HLS_INPUT_CLOCK=10.000000,HLS_INPUT_ARCH=dataflow,HLS_SYN_CLOCK=8.742000,HLS_SYN_LAT=6436,HLS_SYN_TPT=4506,HLS_SYN_MEM=4,HLS_SYN_DSP=6,HLS_SYN_FF=565,HLS_SYN_LUT=970,HLS_VERSION=2018_3}" *)

module conv2d (
        ap_clk,
        ap_rst,
        input_r_address0,
        input_r_ce0,
        input_r_d0,
        input_r_q0,
        input_r_we0,
        input_r_address1,
        input_r_ce1,
        input_r_d1,
        input_r_q1,
        input_r_we1,
        kernel_address0,
        kernel_ce0,
        kernel_d0,
        kernel_q0,
        kernel_we0,
        kernel_address1,
        kernel_ce1,
        kernel_d1,
        kernel_q1,
        kernel_we1,
        result_address0,
        result_ce0,
        result_d0,
        result_q0,
        result_we0,
        result_address1,
        result_ce1,
        result_d1,
        result_q1,
        result_we1,
        ap_start,
        ap_done,
        ap_ready,
        ap_idle
);


input   ap_clk;
input   ap_rst;
output  [9:0] input_r_address0;
output   input_r_ce0;
output  [31:0] input_r_d0;
input  [31:0] input_r_q0;
output   input_r_we0;
output  [9:0] input_r_address1;
output   input_r_ce1;
output  [31:0] input_r_d1;
input  [31:0] input_r_q1;
output   input_r_we1;
output  [3:0] kernel_address0;
output   kernel_ce0;
output  [31:0] kernel_d0;
input  [31:0] kernel_q0;
output   kernel_we0;
output  [3:0] kernel_address1;
output   kernel_ce1;
output  [31:0] kernel_d1;
input  [31:0] kernel_q1;
output   kernel_we1;
output  [9:0] result_address0;
output   result_ce0;
output  [31:0] result_d0;
input  [31:0] result_q0;
output   result_we0;
output  [9:0] result_address1;
output   result_ce1;
output  [31:0] result_d1;
input  [31:0] result_q1;
output   result_we1;
input   ap_start;
output   ap_done;
output   ap_ready;
output   ap_idle;

wire   [31:0] buffer_i_q0;
wire   [31:0] buffer_i_q1;
wire   [31:0] buffer_t_q0;
wire   [31:0] buffer_t_q1;
wire   [31:0] output_i_q0;
wire   [31:0] output_t_q0;
wire    load_input_U0_ap_start;
wire    load_input_U0_ap_done;
wire    load_input_U0_ap_continue;
wire    load_input_U0_ap_idle;
wire    load_input_U0_ap_ready;
wire   [9:0] load_input_U0_input_r_address0;
wire    load_input_U0_input_r_ce0;
wire   [9:0] load_input_U0_buffer_r_address0;
wire    load_input_U0_buffer_r_ce0;
wire    load_input_U0_buffer_r_we0;
wire   [31:0] load_input_U0_buffer_r_d0;
wire    ap_channel_done_buffer;
wire    load_input_U0_buffer_r_full_n;
wire    convolution_kernel_U0_ap_start;
wire    convolution_kernel_U0_ap_done;
wire    convolution_kernel_U0_ap_continue;
wire    convolution_kernel_U0_ap_idle;
wire    convolution_kernel_U0_ap_ready;
wire   [9:0] convolution_kernel_U0_buffer_r_address0;
wire    convolution_kernel_U0_buffer_r_ce0;
wire   [9:0] convolution_kernel_U0_buffer_r_address1;
wire    convolution_kernel_U0_buffer_r_ce1;
wire   [3:0] convolution_kernel_U0_kernel_address0;
wire    convolution_kernel_U0_kernel_ce0;
wire   [3:0] convolution_kernel_U0_kernel_address1;
wire    convolution_kernel_U0_kernel_ce1;
wire   [9:0] convolution_kernel_U0_output_r_address0;
wire    convolution_kernel_U0_output_r_ce0;
wire    convolution_kernel_U0_output_r_we0;
wire   [31:0] convolution_kernel_U0_output_r_d0;
wire    ap_channel_done_output;
wire    convolution_kernel_U0_output_r_full_n;
wire    write_output_U0_ap_start;
wire    write_output_U0_ap_done;
wire    write_output_U0_ap_continue;
wire    write_output_U0_ap_idle;
wire    write_output_U0_ap_ready;
wire   [9:0] write_output_U0_output_r_address0;
wire    write_output_U0_output_r_ce0;
wire   [9:0] write_output_U0_result_address0;
wire    write_output_U0_result_ce0;
wire    write_output_U0_result_we0;
wire   [31:0] write_output_U0_result_d0;
wire    ap_sync_continue;
wire    buffer_i_full_n;
wire    buffer_t_empty_n;
wire   [31:0] buffer_t_d1;
wire    buffer_t_we1;
wire    output_i_full_n;
wire    output_t_empty_n;
wire    ap_sync_done;
wire    ap_sync_ready;
reg    ap_sync_reg_load_input_U0_ap_ready;
wire    ap_sync_load_input_U0_ap_ready;
reg   [1:0] load_input_U0_ap_ready_count;
reg    ap_sync_reg_convolution_kernel_U0_ap_ready;
wire    ap_sync_convolution_kernel_U0_ap_ready;
reg   [1:0] convolution_kernel_U0_ap_ready_count;
wire    load_input_U0_start_full_n;
wire    load_input_U0_start_write;
wire    convolution_kernel_U0_start_full_n;
wire    convolution_kernel_U0_start_write;
wire    write_output_U0_start_full_n;
wire    write_output_U0_start_write;

// power-on initialization
initial begin
#0 ap_sync_reg_load_input_U0_ap_ready = 1'b0;
#0 load_input_U0_ap_ready_count = 2'd0;
#0 ap_sync_reg_convolution_kernel_U0_ap_ready = 1'b0;
#0 convolution_kernel_U0_ap_ready_count = 2'd0;
end

conv2d_buffer #(
    .DataWidth( 32 ),
    .AddressRange( 1024 ),
    .AddressWidth( 10 ))
buffer_U(
    .clk(ap_clk),
    .reset(ap_rst),
    .i_address0(load_input_U0_buffer_r_address0),
    .i_ce0(load_input_U0_buffer_r_ce0),
    .i_we0(load_input_U0_buffer_r_we0),
    .i_d0(load_input_U0_buffer_r_d0),
    .i_q0(buffer_i_q0),
    .i_address1(10'd0),
    .i_ce1(1'b0),
    .i_q1(buffer_i_q1),
    .t_address0(convolution_kernel_U0_buffer_r_address0),
    .t_ce0(convolution_kernel_U0_buffer_r_ce0),
    .t_we0(1'b0),
    .t_d0(32'd0),
    .t_q0(buffer_t_q0),
    .t_address1(convolution_kernel_U0_buffer_r_address1),
    .t_ce1(convolution_kernel_U0_buffer_r_ce1),
    .t_q1(buffer_t_q1),
    .i_ce(1'b1),
    .t_ce(1'b1),
    .i_full_n(buffer_i_full_n),
    .i_write(load_input_U0_ap_done),
    .t_empty_n(buffer_t_empty_n),
    .t_read(convolution_kernel_U0_ap_ready)
);

conv2d_output #(
    .DataWidth( 32 ),
    .AddressRange( 900 ),
    .AddressWidth( 10 ))
output_U(
    .clk(ap_clk),
    .reset(ap_rst),
    .i_address0(convolution_kernel_U0_output_r_address0),
    .i_ce0(convolution_kernel_U0_output_r_ce0),
    .i_we0(convolution_kernel_U0_output_r_we0),
    .i_d0(convolution_kernel_U0_output_r_d0),
    .i_q0(output_i_q0),
    .t_address0(write_output_U0_output_r_address0),
    .t_ce0(write_output_U0_output_r_ce0),
    .t_we0(1'b0),
    .t_d0(32'd0),
    .t_q0(output_t_q0),
    .i_ce(1'b1),
    .t_ce(1'b1),
    .i_full_n(output_i_full_n),
    .i_write(convolution_kernel_U0_ap_done),
    .t_empty_n(output_t_empty_n),
    .t_read(write_output_U0_ap_ready)
);

load_input load_input_U0(
    .ap_clk(ap_clk),
    .ap_rst(ap_rst),
    .ap_start(load_input_U0_ap_start),
    .ap_done(load_input_U0_ap_done),
    .ap_continue(load_input_U0_ap_continue),
    .ap_idle(load_input_U0_ap_idle),
    .ap_ready(load_input_U0_ap_ready),
    .input_r_address0(load_input_U0_input_r_address0),
    .input_r_ce0(load_input_U0_input_r_ce0),
    .input_r_q0(input_r_q0),
    .buffer_r_address0(load_input_U0_buffer_r_address0),
    .buffer_r_ce0(load_input_U0_buffer_r_ce0),
    .buffer_r_we0(load_input_U0_buffer_r_we0),
    .buffer_r_d0(load_input_U0_buffer_r_d0)
);

convolution_kernel convolution_kernel_U0(
    .ap_clk(ap_clk),
    .ap_rst(ap_rst),
    .ap_start(convolution_kernel_U0_ap_start),
    .ap_done(convolution_kernel_U0_ap_done),
    .ap_continue(convolution_kernel_U0_ap_continue),
    .ap_idle(convolution_kernel_U0_ap_idle),
    .ap_ready(convolution_kernel_U0_ap_ready),
    .buffer_r_address0(convolution_kernel_U0_buffer_r_address0),
    .buffer_r_ce0(convolution_kernel_U0_buffer_r_ce0),
    .buffer_r_q0(buffer_t_q0),
    .buffer_r_address1(convolution_kernel_U0_buffer_r_address1),
    .buffer_r_ce1(convolution_kernel_U0_buffer_r_ce1),
    .buffer_r_q1(buffer_t_q1),
    .kernel_address0(convolution_kernel_U0_kernel_address0),
    .kernel_ce0(convolution_kernel_U0_kernel_ce0),
    .kernel_q0(kernel_q0),
    .kernel_address1(convolution_kernel_U0_kernel_address1),
    .kernel_ce1(convolution_kernel_U0_kernel_ce1),
    .kernel_q1(kernel_q1),
    .output_r_address0(convolution_kernel_U0_output_r_address0),
    .output_r_ce0(convolution_kernel_U0_output_r_ce0),
    .output_r_we0(convolution_kernel_U0_output_r_we0),
    .output_r_d0(convolution_kernel_U0_output_r_d0)
);

write_output write_output_U0(
    .ap_clk(ap_clk),
    .ap_rst(ap_rst),
    .ap_start(write_output_U0_ap_start),
    .ap_done(write_output_U0_ap_done),
    .ap_continue(write_output_U0_ap_continue),
    .ap_idle(write_output_U0_ap_idle),
    .ap_ready(write_output_U0_ap_ready),
    .output_r_address0(write_output_U0_output_r_address0),
    .output_r_ce0(write_output_U0_output_r_ce0),
    .output_r_q0(output_t_q0),
    .result_address0(write_output_U0_result_address0),
    .result_ce0(write_output_U0_result_ce0),
    .result_we0(write_output_U0_result_we0),
    .result_d0(write_output_U0_result_d0)
);

always @ (posedge ap_clk) begin
    if (ap_rst == 1'b1) begin
        ap_sync_reg_convolution_kernel_U0_ap_ready <= 1'b0;
    end else begin
        if (((ap_sync_ready & ap_start) == 1'b1)) begin
            ap_sync_reg_convolution_kernel_U0_ap_ready <= 1'b0;
        end else begin
            ap_sync_reg_convolution_kernel_U0_ap_ready <= ap_sync_convolution_kernel_U0_ap_ready;
        end
    end
end

always @ (posedge ap_clk) begin
    if (ap_rst == 1'b1) begin
        ap_sync_reg_load_input_U0_ap_ready <= 1'b0;
    end else begin
        if (((ap_sync_ready & ap_start) == 1'b1)) begin
            ap_sync_reg_load_input_U0_ap_ready <= 1'b0;
        end else begin
            ap_sync_reg_load_input_U0_ap_ready <= ap_sync_load_input_U0_ap_ready;
        end
    end
end

always @ (posedge ap_clk) begin
    if (((convolution_kernel_U0_ap_ready == 1'b0) & (ap_sync_ready == 1'b1))) begin
        convolution_kernel_U0_ap_ready_count <= (convolution_kernel_U0_ap_ready_count - 2'd1);
    end else if (((ap_sync_ready == 1'b0) & (convolution_kernel_U0_ap_ready == 1'b1))) begin
        convolution_kernel_U0_ap_ready_count <= (convolution_kernel_U0_ap_ready_count + 2'd1);
    end
end

always @ (posedge ap_clk) begin
    if (((load_input_U0_ap_ready == 1'b0) & (ap_sync_ready == 1'b1))) begin
        load_input_U0_ap_ready_count <= (load_input_U0_ap_ready_count - 2'd1);
    end else if (((ap_sync_ready == 1'b0) & (load_input_U0_ap_ready == 1'b1))) begin
        load_input_U0_ap_ready_count <= (load_input_U0_ap_ready_count + 2'd1);
    end
end

assign ap_channel_done_buffer = load_input_U0_ap_done;

assign ap_channel_done_output = convolution_kernel_U0_ap_done;

assign ap_done = write_output_U0_ap_done;

assign ap_idle = (write_output_U0_ap_idle & load_input_U0_ap_idle & (output_t_empty_n ^ 1'b1) & (buffer_t_empty_n ^ 1'b1) & convolution_kernel_U0_ap_idle);

assign ap_ready = ap_sync_ready;

assign ap_sync_continue = 1'b1;

assign ap_sync_convolution_kernel_U0_ap_ready = (convolution_kernel_U0_ap_ready | ap_sync_reg_convolution_kernel_U0_ap_ready);

assign ap_sync_done = write_output_U0_ap_done;

assign ap_sync_load_input_U0_ap_ready = (load_input_U0_ap_ready | ap_sync_reg_load_input_U0_ap_ready);

assign ap_sync_ready = (ap_sync_load_input_U0_ap_ready & ap_sync_convolution_kernel_U0_ap_ready);

assign buffer_t_d1 = 32'd0;

assign buffer_t_we1 = 1'b0;

assign convolution_kernel_U0_ap_continue = output_i_full_n;

assign convolution_kernel_U0_ap_start = ((ap_sync_reg_convolution_kernel_U0_ap_ready ^ 1'b1) & buffer_t_empty_n & ap_start);

assign convolution_kernel_U0_output_r_full_n = output_i_full_n;

assign convolution_kernel_U0_start_full_n = 1'b1;

assign convolution_kernel_U0_start_write = 1'b0;

assign input_r_address0 = load_input_U0_input_r_address0;

assign input_r_address1 = 10'd0;

assign input_r_ce0 = load_input_U0_input_r_ce0;

assign input_r_ce1 = 1'b0;

assign input_r_d0 = 32'd0;

assign input_r_d1 = 32'd0;

assign input_r_we0 = 1'b0;

assign input_r_we1 = 1'b0;

assign kernel_address0 = convolution_kernel_U0_kernel_address0;

assign kernel_address1 = convolution_kernel_U0_kernel_address1;

assign kernel_ce0 = convolution_kernel_U0_kernel_ce0;

assign kernel_ce1 = convolution_kernel_U0_kernel_ce1;

assign kernel_d0 = 32'd0;

assign kernel_d1 = 32'd0;

assign kernel_we0 = 1'b0;

assign kernel_we1 = 1'b0;

assign load_input_U0_ap_continue = buffer_i_full_n;

assign load_input_U0_ap_start = ((ap_sync_reg_load_input_U0_ap_ready ^ 1'b1) & ap_start);

assign load_input_U0_buffer_r_full_n = buffer_i_full_n;

assign load_input_U0_start_full_n = 1'b1;

assign load_input_U0_start_write = 1'b0;

assign result_address0 = write_output_U0_result_address0;

assign result_address1 = 10'd0;

assign result_ce0 = write_output_U0_result_ce0;

assign result_ce1 = 1'b0;

assign result_d0 = write_output_U0_result_d0;

assign result_d1 = 32'd0;

assign result_we0 = write_output_U0_result_we0;

assign result_we1 = 1'b0;

assign write_output_U0_ap_continue = 1'b1;

assign write_output_U0_ap_start = output_t_empty_n;

assign write_output_U0_start_full_n = 1'b1;

assign write_output_U0_start_write = 1'b0;

endmodule //conv2d
